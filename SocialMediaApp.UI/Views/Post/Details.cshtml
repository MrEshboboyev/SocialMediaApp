@model PostDetailsVM

<div class="container mt-5">
    <!-- Post Details -->
    <div class="card shadow-sm mb-4">
        <div class="card-header bg-info text-white">
            <h4>@Model.Post.OwnerName</h4>
            <small class="text-muted">@Model.Post.CreatedAt.ToString("MMMM dd, yyyy hh:mm tt")</small>
        </div>
        <div class="card-body">
            <p>@Model.Post.Content</p>
        </div>
    </div>

    <!-- Comments Section -->
    <div class="card shadow-sm">
        <div class="card-header bg-secondary text-white">
            <h5>Comments</h5>
        </div>
        <div class="card-body">
            @foreach (var comment in Model.Comments)
            {
                <div id="comment-@comment.Id">
                    @Html.Partial("_CommentPartial", comment)
                </div>
            }
        </div>
    </div>

    <!-- Add a Comment Section (Include the _CreateCommentPartial here) -->
    <div class="mt-4">
        @Html.Partial("_CreateCommentPartial", new CommentDTO { PostId = Model.Post.Id })
    </div>
</div>

@section Scripts {
    <script>
        function loadEditForm(commentId) {
            $.get('@Url.Action("Update", "Comment")', { commentId: commentId }, function(data) {
                $('#editCommentForm-' + commentId).html(data).show();
            });
        }

        function confirmDelete(commentId) {
            if (confirm('Are you sure you want to delete this comment?')) {
                $.post('@Url.Action("Delete", "Comment")', { commentId: commentId }, function(response) {
                    if (response.success) {
                        $('#comment-' + commentId).remove();  // Remove the deleted comment from the DOM
                    } else {
                        alert('Error deleting comment.');
                    }
                });
            }
        }

        $(document).on('submit', '#editCommentForm', function(event) {
            event.preventDefault();  // Prevent the form from submitting the traditional way
            var formData = $(this).serialize();

            $.post('@Url.Action("Update", "Comment")', formData, function(response) {
                if (response.success) {
                    location.reload();  // Reload the page or dynamically update the comment
                } else {
                    alert('Error updating comment.');
                }
            });
        });
    </script>
}